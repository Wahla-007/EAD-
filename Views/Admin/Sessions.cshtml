@using System.Linq
@model List<AttendanceManagementSystem.Data.Entities.Session>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#x1F393;</text></svg>">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Session Management - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="~/css/neo-brutalist.css" />
</head>
<body>
    <div class="neo-container">
        <aside class="neo-sidebar">
            <div class="neo-sidebar-header">
                <h2>AMS Admin</h2>
                <p>// Session Management</p>
            </div>
            <nav class="neo-sidebar-menu">
                <a href="/Admin/Dashboard" class="neo-menu-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
                <a href="/Admin/Students" class="neo-menu-item"><i class="fas fa-user-graduate"></i><span>Students</span></a>
                <a href="/Admin/Teachers" class="neo-menu-item"><i class="fas fa-chalkboard-teacher"></i><span>Teachers</span></a>
                <a href="/Admin/Courses" class="neo-menu-item"><i class="fas fa-book"></i><span>Courses</span></a>
                <a href="/Admin/Sessions" class="neo-menu-item active"><i class="fas fa-calendar-alt"></i><span>Sessions</span></a>
                <a href="/Admin/Departments" class="neo-menu-item"><i class="fas fa-building"></i><span>Departments</span></a>
                <a href="/Admin/Reports" class="neo-menu-item"><i class="fas fa-chart-bar"></i><span>Reports</span></a>
                <a href="/Account/Logout" class="neo-menu-item"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </nav>
        </aside>

        <main class="neo-main">
            <div class="neo-topbar">
                <div>
                    <h1><i class="fas fa-calendar-alt"></i> Session Management</h1>
                    <p>// Manage academic sessions and semesters</p>
                </div>
                <div class="neo-topbar-actions">
                    <button onclick="openCreateSessionModal()" class="neo-btn neo-btn-primary">
                        <i class="fas fa-plus"></i> Create Session
                    </button>
                    <a href="/Admin/Dashboard" class="neo-btn"><i class="fas fa-arrow-left"></i> Back</a>
                </div>
            </div>

            @if (TempData["Success"] != null)
            {
                <div class="neo-alert neo-alert-success">
                    <i class="fas fa-check-circle"></i> @TempData["Success"]
                </div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="neo-alert neo-alert-danger">
                    <i class="fas fa-exclamation-circle"></i> @TempData["Error"]
                </div>
            }

            <div class="neo-card">
                <div class="neo-card-header">
                    <h3><i class="fas fa-list"></i> All Sessions</h3>
                </div>
                <div class="neo-table-wrapper">
                    <table class="neo-table">
                        <thead>
                            <tr>
                                <th>Session Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Semesters</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Any())
                            {
                                foreach (var session in Model)
                                {
                                    <tr>
                                        <td><strong>@session.SessionName</strong></td>
                                        <td>@session.StartDate.ToString("MMM dd, yyyy")</td>
                                        <td>@session.EndDate.ToString("MMM dd, yyyy")</td>
                                        <td>
                                            @if (session.IsActive)
                                            {
                                                <span class="neo-badge neo-badge-success">Active</span>
                                            }
                                            else
                                            {
                                                <span class="neo-badge">Inactive</span>
                                            }
                                        </td>
                                        <td>@(session.Semesters?.Count ?? 0) semesters</td>
                                        <td>
                                            <button class="neo-btn neo-btn-sm neo-btn-success" onclick="openCreateSemesterModal(@session.SessionId, '@session.SessionName')">
                                                <i class="fas fa-plus"></i> Add Semester
                                            </button>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6">
                                        <div class="neo-empty">
                                            <i class="fas fa-calendar-times"></i>
                                            <p>No sessions found. Create one to get started.</p>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="neo-card">
                <div class="neo-card-header">
                    <h3><i class="fas fa-layer-group"></i> Semesters & Sections</h3>
                </div>
                <div id="semestersList">
                    <div class="neo-empty"><i class="fas fa-spinner fa-spin"></i><p>Loading semesters...</p></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Session Modal -->
    <div class="neo-modal-overlay" id="createSessionModal" style="display: none;">
        <div class="neo-modal">
            <div class="neo-modal-header">
                <h3><i class="fas fa-calendar-plus"></i> Create New Session</h3>
                <button class="neo-modal-close" onclick="closeModal('createSessionModal')">Ã—</button>
            </div>
            <form method="post" action="/Admin/CreateSession">
                <div class="neo-form-group">
                    <label class="neo-label">Session Name (e.g., 2025-2026)</label>
                    <input type="text" name="sessionName" class="neo-input" required placeholder="2025-2026">
                </div>
                <div class="neo-form-group">
                    <label class="neo-label">Start Date</label>
                    <input type="date" name="startDate" class="neo-input" required>
                </div>
                <div class="neo-form-group">
                    <label class="neo-label">End Date</label>
                    <input type="date" name="endDate" class="neo-input" required>
                </div>
                <button type="submit" class="neo-btn neo-btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Create Session
                </button>
            </form>
        </div>
    </div>

    <!-- Create Semester Modal -->
    <div class="neo-modal-overlay" id="createSemesterModal" style="display: none;">
        <div class="neo-modal">
            <div class="neo-modal-header">
                <h3><i class="fas fa-clock"></i> Add Semester to <span id="sessionNameLabel"></span></h3>
                <button class="neo-modal-close" onclick="closeModal('createSemesterModal')">Ã—</button>
            </div>
            <form method="post" action="/Admin/CreateSemester">
                <input type="hidden" name="sessionId" id="semesterSessionId">
                <div class="neo-form-group">
                    <label class="neo-label">Semester Name (e.g., Fall 2025)</label>
                    <input type="text" name="semesterName" class="neo-input" required placeholder="Fall 2025">
                </div>
                <div class="neo-form-group">
                    <label class="neo-label">Semester Number</label>
                    <input type="number" name="semesterNumber" class="neo-input" required min="1" max="8" placeholder="1">
                </div>
                <div class="neo-form-group">
                    <label class="neo-label">Start Date</label>
                    <input type="date" name="startDate" class="neo-input" required>
                </div>
                <div class="neo-form-group">
                    <label class="neo-label">End Date</label>
                    <input type="date" name="endDate" class="neo-input" required>
                </div>
                <button type="submit" class="neo-btn neo-btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Create Semester
                </button>
            </form>
        </div>
    </div>

    <script>
        function openCreateSessionModal() {
            document.getElementById('createSessionModal').style.display = 'flex';
        }
        function openCreateSemesterModal(sessionId, sessionName) {
            document.getElementById('semesterSessionId').value = sessionId;
            document.getElementById('sessionNameLabel').textContent = sessionName;
            document.getElementById('createSemesterModal').style.display = 'flex';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        window.onclick = function(event) {
            if (event.target.classList.contains('neo-modal-overlay')) {
                event.target.style.display = 'none';
            }
        }
        async function loadSemesters() {
            try {
                const response = await fetch('/Admin/GetSemestersWithSections');
                const data = await response.json();
                let html = '<div class="neo-table-wrapper"><table class="neo-table"><thead><tr><th>Semester</th><th>Session</th><th>Sections</th><th>Date Range</th></tr></thead><tbody>';
                if (data.length === 0) {
                    html += '<tr><td colspan="4"><div class="neo-empty"><i class="fas fa-inbox"></i><p>No semesters found</p></div></td></tr>';
                } else {
                    data.forEach(sem => {
                        html += `<tr>
                            <td><strong>${sem.semesterName}</strong></td>
                            <td>${sem.sessionName}</td>
                            <td><span class="neo-badge neo-badge-info">${sem.sectionCount} sections</span></td>
                            <td style="font-family: var(--font-mono);">${new Date(sem.startDate).toLocaleDateString()} - ${new Date(sem.endDate).toLocaleDateString()}</td>
                        </tr>`;
                    });
                }
                html += '</tbody></table></div>';
                document.getElementById('semestersList').innerHTML = html;
            } catch (error) {
                console.error('Error loading semesters:', error);
            }
        }
        window.onload = loadSemesters;
    </script>
</body>
</html>

