@{
    Layout = null;
    ViewData["TeacherId"] = ViewBag.TeacherId;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Reports - Attendance Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="~/css/neo-brutalist.css" />
    <style>
        .neo-sidebar { background: #22c55e; }
        .neo-sidebar-header { background: #000; color: #22c55e; }
        .neo-sidebar-header p { color: white; }
        .neo-menu-item { color: #000; border-color: rgba(0,0,0,0.1); }
        .neo-menu-item:hover, .neo-menu-item.active { background: #000; color: #22c55e; }
        
        .progress-bar {
            height: 12px;
            background: var(--bg-paper);
            border: 2px solid #000;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            background: #22c55e;
            transition: width 0.3s;
        }
        @@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <div class="neo-container">
        <aside class="neo-sidebar">
            <div class="neo-sidebar-header">
                <h2>AMS Teacher</h2>
                <p>// My Reports</p>
            </div>
            <nav class="neo-sidebar-menu">
                <a href="/Teacher/Dashboard" class="neo-menu-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
                <a href="/Teacher/MyCourses" class="neo-menu-item"><i class="fas fa-book"></i><span>My Courses</span></a>
                <a href="/Teacher/Attendance" class="neo-menu-item"><i class="fas fa-calendar-check"></i><span>Attendance</span></a>
                <a href="/Teacher/Students" class="neo-menu-item"><i class="fas fa-user-graduate"></i><span>Students</span></a>
                <a href="/Teacher/Schedule" class="neo-menu-item"><i class="fas fa-clock"></i><span>Schedule</span></a>
                <a href="/Teacher/Reports" class="neo-menu-item active"><i class="fas fa-chart-bar"></i><span>Reports</span></a>
                <a href="/Account/Logout" class="neo-menu-item"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </nav>
        </aside>

        <main class="neo-main">
            <div class="neo-topbar">
                <div>
                    <h1><i class="fas fa-chart-bar"></i> My Reports</h1>
                    <p>// Attendance statistics for your courses</p>
                </div>
                <div class="neo-topbar-actions">
                    <a href="/Teacher/Dashboard" class="neo-btn"><i class="fas fa-arrow-left"></i> Back</a>
                </div>
            </div>

            <div id="statsGrid" class="neo-stats-grid">
                <div class="neo-card" style="text-align: center; padding: 40px;">
                    <i class="fas fa-spinner loading-spinner" style="font-size: 32px; color: #22c55e;"></i>
                    <p style="margin-top: 15px; font-family: var(--font-mono);">Loading statistics...</p>
                </div>
            </div>

            <div class="neo-card">
                <div class="neo-card-header">
                    <h3>Course-wise Attendance Summary</h3>
                </div>
                <div id="courseTable">
                    <div class="neo-empty">
                        <i class="fas fa-spinner loading-spinner"></i>
                        <p>Loading reports...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        async function loadReports() {
            try {
                const teacherId = @ViewData["TeacherId"];
                const response = await fetch(`/Teacher/GetTeacherReports?teacherId=${teacherId}`);
                const data = await response.json();

                document.getElementById('statsGrid').innerHTML = `
                    <div class="neo-stat-card green">
                        <div class="neo-stat-icon green"><i class="fas fa-book"></i></div>
                        <div class="neo-stat-value">${data.totalCourses}</div>
                        <div class="neo-stat-label">Total Courses</div>
                    </div>
                    <div class="neo-stat-card cyan">
                        <div class="neo-stat-icon cyan"><i class="fas fa-user-graduate"></i></div>
                        <div class="neo-stat-value">${data.totalStudents}</div>
                        <div class="neo-stat-label">Total Students</div>
                    </div>
                    <div class="neo-stat-card purple">
                        <div class="neo-stat-icon purple"><i class="fas fa-calendar-check"></i></div>
                        <div class="neo-stat-value">${data.totalClasses}</div>
                        <div class="neo-stat-label">Classes Conducted</div>
                    </div>
                    <div class="neo-stat-card orange">
                        <div class="neo-stat-icon orange"><i class="fas fa-percentage"></i></div>
                        <div class="neo-stat-value">${data.avgAttendance.toFixed(1)}%</div>
                        <div class="neo-stat-label">Avg Attendance</div>
                    </div>
                `;

                if (data.courses && data.courses.length > 0) {
                    let tableHTML = `
                        <div class="neo-table-wrapper">
                            <table class="neo-table">
                                <thead>
                                    <tr>
                                        <th>Course Code</th>
                                        <th>Course Name</th>
                                        <th>Section</th>
                                        <th>Students</th>
                                        <th>Classes</th>
                                        <th>Attendance %</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    data.courses.forEach(course => {
                        tableHTML += `
                            <tr>
                                <td><strong>${course.courseCode}</strong></td>
                                <td>${course.courseName}</td>
                                <td>${course.sectionName}</td>
                                <td><span class="neo-badge neo-badge-info">${course.studentCount}</span></td>
                                <td>${course.classesCount}</td>
                                <td>
                                    <strong style="color: #22c55e; font-family: var(--font-mono);">${course.attendancePercentage.toFixed(1)}%</strong>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${course.attendancePercentage}%"></div>
                                    </div>
                                </td>
                            </tr>`;
                    });

                    tableHTML += `</tbody></table></div>`;
                    document.getElementById('courseTable').innerHTML = tableHTML;
                } else {
                    document.getElementById('courseTable').innerHTML = '<div class="neo-empty"><i class="fas fa-chart-bar"></i><p>No course data available</p></div>';
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                document.getElementById('statsGrid').innerHTML = '<div class="neo-alert neo-alert-danger"><i class="fas fa-exclamation-circle"></i> Error loading statistics</div>';
                document.getElementById('courseTable').innerHTML = '<div class="neo-alert neo-alert-danger"><i class="fas fa-exclamation-circle"></i> Error loading reports</div>';
            }
        }

        loadReports();
    </script>
</body>
</html>
